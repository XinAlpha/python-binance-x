# 动量回踩加仓策略说明

## 📊 策略概述

**策略名称**：动量回踩加仓策略 (Momentum Dip Buying Strategy)

**策略类型**：趋势跟随 + 分批建仓

**风险等级**：⚠️ 高风险

**适用K线周期**：5分钟（必须！）

**适用市场**：强势上涨行情、高波动市场

---

## 🎯 策略逻辑

### 核心思路

利用快速上涨的动量效应，在回调时分批加仓，实现低风险高收益。

### 详细规则

#### 1️⃣ 首次开仓条件

**触发条件**：
- 5分钟K线涨幅 > 5%（可配置）
- 成交量放大（可选确认）

**开仓方式**：
- 使用 50% 资金
- 应用 2 倍杠杆
- 实际仓位 = 账户资金 × 50% × 2 = 账户资金 × 100%

**示例**：
```
账户资金：10000 USDT
BTC价格：50000 USDT
开仓资金：10000 × 50% × 2 = 10000 USDT
开仓数量：10000 / 50000 = 0.2 BTC
```

#### 2️⃣ 加仓条件

**触发条件**：
- 首次开仓后，价格回调 > 3%（可配置）
- 尚未加仓

**加仓方式**：
- 使用剩余 50% 资金
- 应用 2 倍杠杆
- 加仓金额 = 账户资金 × 50% × 2 = 账户资金 × 100%

**加仓后**：
- 计算平均持仓成本
- 总仓位 = 首仓 + 加仓

**示例**：
```
首次开仓价：50000 USDT, 数量：0.2 BTC
价格回调至：48500 USDT（-3%）
加仓金额：10000 USDT
加仓数量：10000 / 48500 = 0.206 BTC

总持仓：0.2 + 0.206 = 0.406 BTC
平均成本：(50000×0.2 + 48500×0.206) / 0.406 = 49238 USDT
```

#### 3️⃣ 止盈条件

**从平均成本计算**：
- 价格上涨 > 5%（可配置）
- 平仓所有持仓

**示例**：
```
平均成本：49238 USDT
止盈价格：49238 × 1.05 = 51700 USDT
盈利：(51700 - 49238) × 0.406 = 1000 USDT
收益率：1000 / 10000 = 10%
```

#### 4️⃣ 止损条件

**仅在加仓后生效**：
- 从加仓价格计算，再次下跌 > 3%
- 平仓所有持仓

**示例**：
```
加仓价格：48500 USDT
止损价格：48500 × 0.97 = 47045 USDT
亏损：(49238 - 47045) × 0.406 = 890 USDT
亏损率：890 / 10000 = 8.9%
```

---

## 💰 收益与风险

### 盈利场景

**场景1：快速反弹（最佳）**
```
1. 价格涨5% → 开仓（50%资金）
2. 价格不回调 → 直接止盈
3. 收益：5% × 50% × 2倍杠杆 = 5%
```

**场景2：回调后上涨（理想）**
```
1. 价格涨5% → 开仓（50%资金，50000U）
2. 回调3% → 加仓（50%资金，48500U）
3. 价格从平均成本49238上涨5% → 止盈51700U
4. 收益：约10%
```

### 亏损场景

**场景1：假突破（常见）**
```
1. 价格涨5% → 开仓
2. 价格回调3% → 加仓
3. 价格再跌3% → 止损
4. 亏损：约8-9%
```

**场景2：快速下跌（风险）**
```
1. 价格涨5% → 开仓
2. 价格暴跌 → 被迫止损或爆仓
3. 亏损：可能超过10%
```

### 风险收益比

- **盈亏比**：约 1:1 到 1.2:1
- **胜率要求**：需要 > 50% 才能盈利
- **最大亏损**：约 -10%（单次）
- **最大盈利**：约 +10%（单次）

---

## ⚙️ 参数配置

### 默认参数

```yaml
strategy:
  name: "momentum_dip_buying"
  params:
    pump_threshold: 0.05      # 5% 快速涨幅
    dip_threshold: 0.03       # 3% 回调阈值
    profit_target: 0.05       # 5% 止盈目标
    position_1_ratio: 0.5     # 首仓50%
    leverage_multiplier: 2    # 2倍杠杆
```

### 参数调整建议

#### 激进配置（追求高收益）

```yaml
params:
  pump_threshold: 0.03      # 3% 就开仓（更频繁）
  dip_threshold: 0.02       # 2% 就加仓（更激进）
  profit_target: 0.08       # 8% 止盈（期望更高收益）
  position_1_ratio: 0.6     # 首仓60%（首仓更重）
  leverage_multiplier: 3    # 3倍杠杆（风险更高）
```

风险：假信号增多，亏损幅度加大

#### 保守配置（降低风险）

```yaml
params:
  pump_threshold: 0.08      # 8% 才开仓（更谨慎）
  dip_threshold: 0.05       # 5% 才加仓（更保守）
  profit_target: 0.03       # 3% 就止盈（快速锁利）
  position_1_ratio: 0.4     # 首仓40%（降低风险）
  leverage_multiplier: 1.5  # 1.5倍杠杆（降低杠杆）
```

收益：机会减少，但单次亏损更小

---

## 📈 回测示例

### 配置文件

使用配置文件：`config/momentum_dip_buying_config.yaml`

或者修改 `config/config.yaml`：

```yaml
trading:
  symbol: "BTCUSDT"
  interval: "5m"  # ⚠️ 必须使用5分钟！
  leverage: 10
  initial_capital: 10000

strategy:
  name: "momentum_dip_buying"
  params:
    pump_threshold: 0.05
    dip_threshold: 0.03
    profit_target: 0.05
    position_1_ratio: 0.5
    leverage_multiplier: 2

backtest:
  start_date: "2024-01-01"
  end_date: "2024-12-01"
```

### 运行回测

```bash
# 使用默认配置
python run_backtest.py

# 或使用专用配置
python main.py backtest --config config/momentum_dip_buying_config.yaml
```

---

## ⚠️ 重要提醒

### 必须注意

1. **K线周期必须是5分钟**
   - 策略基于5分钟涨幅计算
   - 使用其他周期会导致信号错误

2. **高风险策略**
   - 使用2倍杠杆
   - 分两次满仓
   - 单次最大亏损可达10%

3. **市场环境**
   - 适合高波动市场
   - 震荡市会频繁止损
   - 单边下跌会持续亏损

4. **资金管理**
   - 建议单次投入不超过总资金的30%
   - 设置账户总止损
   - 连续亏损后暂停交易

### 风险控制建议

```yaml
# 建议配置
trading:
  initial_capital: 3000  # 仅用总资金的30%
  max_position_size: 1.0
  risk_per_trade: 0.05   # 单次最大风险5%

# 实盘交易
live_trading:
  check_interval: 10     # 快速检查
  max_retries: 3
```

---

## 🎓 使用建议

### 适合的交易者

✅ 有期货交易经验
✅ 能承受10%单次亏损
✅ 能够快速反应
✅ 理解加仓策略

### 不适合的交易者

❌ 新手交易者
❌ 风险厌恶型
❌ 无法盯盘
❌ 资金有限

### 优化建议

1. **添加成交量确认**
   - 涨幅配合成交量放大
   - 降低假突破概率

2. **添加趋势过滤**
   - 只在上升趋势中开仓
   - 避免在下跌趋势追高

3. **动态调整参数**
   - 根据波动率调整阈值
   - 低波动提高阈值
   - 高波动降低阈值

4. **设置最大持仓时间**
   - 避免长时间套牢
   - 例如：4小时未止盈则平仓

---

## 📋 完整交易示例

### 成功案例

```
时间：2024-12-17 10:00
BTC价格：49000 → 51450 (+5%)
操作：开仓 50%资金 × 2倍杠杆 @ 51450

时间：10:15
BTC价格：49900 (-3% from 51450)
操作：加仓 50%资金 × 2倍杠杆 @ 49900
平均成本：50675

时间：10:45
BTC价格：53209 (+5% from 50675)
操作：止盈平仓 @ 53209
收益：(53209 - 50675) / 50675 × 100% = 5%
实际收益：5% × 2倍杠杆 × 100%资金 = 10%
盈利：10000 × 10% = 1000 USDT
```

### 失败案例

```
时间：2024-12-17 14:00
BTC价格：50000 → 52500 (+5%)
操作：开仓 50%资金 × 2倍杠杆 @ 52500

时间：14:15
BTC价格：50925 (-3% from 52500)
操作：加仓 50%资金 × 2倍杠杆 @ 50925
平均成本：51712.5

时间：14:30
BTC价格：49397 (-3% from 50925)
操作：止损平仓 @ 49397
亏损：(51712.5 - 49397) / 51712.5 × 100% = -4.5%
实际亏损：-4.5% × 2倍杠杆 × 100%资金 = -9%
损失：10000 × 9% = -900 USDT
```

---

## 🔧 故障排除

### 问题1：没有触发任何信号

**原因**：K线周期不是5分钟

**解决**：检查 `config.yaml` 中 `interval: "5m"`

### 问题2：频繁开仓

**原因**：`pump_threshold` 设置过低

**解决**：提高阈值到 6-8%

### 问题3：从不加仓

**原因**：
1. 市场波动太小
2. `dip_threshold` 设置过高

**解决**：降低到 2-2.5%

### 问题4：止损频繁

**原因**：震荡市场不适合此策略

**解决**：
1. 提高 `pump_threshold`
2. 只在明确上升趋势使用
3. 暂停交易等待趋势

---

## 📚 延伸阅读

- [STRATEGIES.md](STRATEGIES.md) - 其他策略对比
- [UPDATES.md](UPDATES.md) - 框架使用说明
- [QUICKSTART.md](QUICKSTART.md) - 快速开始

---

祝交易顺利！⚠️ 请务必先充分回测再实盘！
